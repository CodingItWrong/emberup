#!/usr/bin/env bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/.."

ember new --no-welcome --yarn $1
cd $1

ember install ember-cli-build-notifications
git add .
git commit -m "Add build notifications"

ember install ember-simple-auth
mkdir app/adapters
cp "${DIR}/template/app/adapters/application.js" app/adapters
mkdir app/authenticators
cp "${DIR}/template/app/authenticators/oauth.js" app/authenticators
mkdir app/components
cp -r "${DIR}/template/app/components" app
cp "${DIR}/template/app/controllers/application.js" app/controllers
mkdir app/templates
cp "${DIR}/template/app/templates/application.hbs" app/templates
git add .
git commit -m "Use Simple Auth"

ember install ember-sinon-qunit
git add .
git commit -m "Add Sinon"

ember install ember-test-selectors
ember install ember-cli-mirage
git add .
git commit -m "Add testing packages"

# force update ember-cli-eslint and its dependencies to fix some kind of error
yarn add -D ember-cli-eslint@^5.1.0

yarn add -D prettier \
            eslint-config-prettier \
            eslint-plugin-prettier@2.6.0
cp "${DIR}/template/.eslintrc.js" .eslintrc.js
cp "${DIR}/template/.prettierrc" .prettierrc
git add .
git commit -m "Add lint packages"

rm .travis.yml
cp -r "${DIR}/template/github" .github
git add .
git commit -m "Set up GitHub Actions workflow"

ember generate serializer application
rm -fr tests/unit/serializers
git add .
git commit -m "Add default JSON:API serializer"

yarn lint:js --fix
git add .
git commit -m "Prettier format"
